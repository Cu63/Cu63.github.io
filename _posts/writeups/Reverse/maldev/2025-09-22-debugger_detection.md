---
title: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—Ç–ª–∞–¥—á–∏–∫–∞"
date: 2025-09-22
tags: [reverse, malware]  
categories: [Reverse]
tagline: ""
header:
  overlay_image: /assets/images/IMG_writeups/IMG_Reverse/IMG_maldev/maldev_logo.jpg
  overlay_filter: 0.5 
  overlay_color: "#fff"
classes: wide
---
{% raw %}
–ü—Ä–∏–≤–µ—Ç:3 –°–µ–≥–æ–¥–Ω—è —Ä–∞–∑–±–µ—Ä–µ–º –æ–¥–Ω—É –∏–∑ —Ç–µ—Ö–Ω–∏–∫ –∞–Ω—Ç–∏–æ—Ç–ª–∞–¥–∫–∏.

–ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∞—Å—Ç–æ –±–µ–∑ ~~–±—É—Ç—ã–ª–∫–∏ –ø–∏–≤–∞~~ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è. –ü–æ—ç—Ç–æ–º—É –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–∏–Ω–∞—Ä—å –ø–æ–¥ –æ—Ç–ª–∞–¥—á–∏–∫–æ–º ‚Äî —ç—Ç–æ –±–∞–∑–∞. –û—á–µ–≤–∏–¥–Ω–æ, —á—Ç–æ –º–∞–ª–≤–∞—Ä—â–∏–∫–∏ —ç—Ç–æ —Ç–æ–∂–µ –∑–Ω–∞—é—Ç. –ü–æ—ç—Ç–æ–º—É –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã –æ—Ç –æ—Ç–ª–∞–¥–∫–∏. –í—Å–µ —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫—Ä–∞—Å–∏–≤—ã–º —Å–ª–æ–≤–æ–º ‚Äî üôå–∞–Ω—Ç–∏–æ—Ç–ª–∞–¥–∫–∞üôå.

–û–¥–Ω–æ–π –∏–∑ —Å–∞–º—ã—Ö –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Ö–Ω–∏–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –æ—Ç–ª–∞–¥—á–∏–∫–∞ —è–≤–ª—è–µ—Ç—Å—è [Debugger Evasion](https://attack.mitre.org/techniques/T1622/). –û–±–Ω–∞—Ä—É–∂–∏–≤ —Ñ–∞–∫—Ç –æ—Ç–ª–∞–¥–∫–∏, –≤—Ä–µ–¥–æ–Ω–æ—Å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ –ø–∞–ª–∏—Ç—å—Å—è)

–°–µ–≥–æ–¥–Ω—è —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏.

## Linux

–£ –¥–∞–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ —Å–ª–µ–¥—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ ‚Äî e—Å–ª–∏ –∫ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É –µ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `ptrace()`, –∑–Ω–∞—á–∏—Ç –∫ –Ω–µ–º—É –ø–æ–¥–∫–ª—é—á–µ–Ω –¥–µ–±–∞–≥–≥–µ—Ä. –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç? –í `Linux` –∫ –æ–¥–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å. –ï—Å–ª–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞, –∑–Ω–∞—á–∏—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å —É–∂–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω –ø–æ–¥ –æ—Ç–ª–∞–¥–∫–æ–π.

### ptrace()

`ptrace()` ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å. 

```c
#include <sys/ptrace.h>

long ptrace(enum __ptrace_request request, pid_t pid, void *addr, void *data);
```

- `request` ‚Äî —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å;
- `pid` ‚Äî PID;
- `addr` –∏ `data` ‚Äî –∑–∞–≤–∏—Å—è—Ç –æ—Ç `request`.

–í –ø–æ–ª–µ `request` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:

- `PTRACE_SINGLESTEP` ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–æ–≤–Ω–æ –æ–¥–Ω—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, –∞ –ø–æ—Ç–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è, —á—Ç–æ–±—ã –æ—Ç–ª–∞–¥—á–∏–∫ –º–æ–≥ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ;
- `PTRACE_SYSCALL` ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ —Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞, –∫–æ–≥–¥–∞ –æ–Ω –≤–æ–π–¥—ë—Ç –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ –∏–ª–∏ –≤—ã–π–¥–µ—Ç –∏–∑ –Ω–µ–≥–æ, —á—Ç–æ –¥–∞—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤—ã–∑–æ–≤–∞ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ;
- `PTRACE_ATTACH` ‚Äî –æ—Ç–ª–∞–¥—á–∏–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –∫ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—â–µ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–º—É —Å–∏–≥–Ω–∞–ª `SIGSTOP`, —á—Ç–æ–±—ã –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, –∏ –∑–∞—Ç–µ–º –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º;

```c
if (ptrace(PTRACE_ATTACH, pid, NULL, NULL) < 0) {
	perror("ptrace_attach");
    exit(EXIT_FAILURE);
}
```

- `PTRACE_PEEKTEXT` ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∞–¥—Ä–µ—Å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞;
- `PTRACE_POKETEXT` ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∞–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞;

```c
size_t data_len = strlen(data);
uint64_t *data_p = (uint64_t *)data;
for (size_t i = 0; i < data_len; i += 8, data_p++) {
    if (ptrace(PTRACE_POKETEXT, pid, address + i, *data_p) < 0) {
        perror("ptarce_poketext");
        exit(EXIT_FAILURE);
    }
}
```

- `PTRACE_GETREGS` ‚Äî —á–∏—Ç–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞. –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ [user_regs_struct](https://docs.huihoo.com/doxygen/linux/kernel/3.7/structuser__regs__struct.html);

```c
struct user_regs_struct old_regs;
if (ptrace(PTRACE_GETREGS, target_pid, NULL, &old_regs) < 0) {
	perror("ptrace_getregs");
	exit(EXIT_FAILURE);
}
```

- `PTRACE_SETREGS` ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞.

```c
struct user_regs_struct regs;
memcpy(&regs, &old_regs, sizeof(struct user_regs_struct));
regs.rip = target_address;

if (ptrace(PTRACE_SETREGS, target_pid, NULL, &regs) < 0) {
	perror("ptrace_setregs");
	exit(EXIT_FAILURE);
}
```

- `PTRACE_CONT` ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–ª–∞–∂–∏–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞;

```c
if (ptrace(PTRACE_CONT, pid, NULL, NULL) < 0) {
	perror("ptrace_cont");
	exit(EXIT_FAILURE);
}
```

### –ü—Ä–∏–º–µ—Ä

[`linux_ex.c`](/assets/files/FILE_writeups/FILE_Reverse/FILE_maldev/FILE_debugger_detection/linux_ex.c).

```c
#include <stdio.h>
#include <sys/ptrace.h>

int main()
{
	if (ptrace(PTRACE_TRACEME, 0, 1, 0) < 0) {
		printf("Debugging Dedected.\n");
		return 1;
	}
	ptrace(PTRACE_DETACH, 0, 1, 0);
	printf("Normal Execution.\n");
	return 0;
}
```

–ó–∞–ø—É—Å–∫:

![IMG](/assets/images/IMG_writeups/IMG_Reverse/IMG_maldev/IMG_debugger_detection/1.png){: height="200" .align-center}

## Windows

–í `Windows` —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –∑–∞–ø—É—â–µ–Ω –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥ –æ—Ç–ª–∞–¥—á–∏–∫–æ–º. –°—Ä–µ–¥–∏ –Ω–∏—Ö `IsDebuggerPresent()`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å, –∏ `CheckRemoteDebuggerPresent()`, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –æ—Ç–ª–∞–¥—á–∏–∫ –≤ –¥—Ä—É–≥–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ.

### `IsDebuggerPresent()`

`IsDebuggerPresent()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `True`, –µ—Å–ª–∏ –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –ø–æ–¥–∫–ª—é—á–µ–Ω –æ—Ç–ª–∞–¥—á–∏–∫. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –æ–Ω–∞ –ø–æ–¥ –æ—Ç–ª–∞–¥–∫–æ–π, –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ä—ã.

```c
#include <stdio.h>
#include <windows.h>

int main() {
	BOOL isDebuggerPresent = IsDebuggerPresent();

	if (isDebuggerPresent) {
		printf("Debugger detected\n");
	} else {
		printf("Debugger not detected\n");
	}
	return 0;
}
```

## `CheckRemoteDebuggerPresent`

`CheckRemoteDebuggerPresent()` ‚Äî —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–ª–∞–¥–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –ø–æ–¥–∫–ª—é—á—ë–Ω –ª–∏ –æ—Ç–ª–∞–¥—á–∏–∫ –∫ –¥—Ä—É–≥–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∫ —Ç–µ–∫—É—â–µ–º—É.

```c
#include <stdio.h>
#include <windows.h>

int main() {
	BOOL isDebuggerPresent = FALSE;
	HANDLE currentProcess = GetCurrentProcess();
	BOOL isRemoteDebuggerPresent = FALSE;

	CheckRemoteDebuggerPresent(currentProcess, &isRemoteDebuggerPresent);

	if (isRemoteDebuggerPresent) {
		printf("Debugger detected\n");
	} else {
		printf("Debugger not detected\n");
    }
	return 0;
}
```

## –ü—Ä–∞–∫—Ç–∏–∫–∞

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–∞–º–∏–º –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –¥–∞–Ω–Ω—É—é —Ç–µ—Ö–Ω–∏–∫—É, –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–µ—à–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á–∫—É: [`SimpleCrackMe.exe`](/assets/files/FILE_writeups/FILE_Reverse/FILE_maldev/FILE_debugger_detection/SimpleCrackMe.exe).
{% endraw %}
